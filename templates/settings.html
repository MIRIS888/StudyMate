{% extends "base_dashboard.html" %}

{% block title %}Nastaven√≠ - StudyMate{% endblock %}
{% block page_title %}Nastaven√≠{% endblock %}

{% block content %}
<div class="settings-container">
    <div class="settings-grid">
        <!-- Profile Settings -->
        <div class="settings-card">
            <div class="card-header">
                <h3>üë§ Profil</h3>
            </div>
            <div class="card-content">
                <form class="settings-form" id="profileForm">
                    <div class="form-group">
                        <label class="form-label">U≈æivatelsk√© jm√©no</label>
                        <input type="text" class="form-control" value="{{ current_user.username }}" readonly>
                        <div class="form-help">U≈æivatelsk√© jm√©no nelze zmƒõnit</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" value="{{ current_user.email }}" readonly>
                        <div class="form-help">Pro zmƒõnu emailu kontaktujte podporu</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Registrace</label>
                        <input type="text" class="form-control" value="{{ current_user.created_at.strftime('%d.%m.%Y %H:%M') }}" readonly>
                    </div>
                </form>
            </div>
        </div>

        <!-- Password Change -->
        <div class="settings-card">
            <div class="card-header">
                <h3>üîí Zmƒõna hesla</h3>
            </div>
            <div class="card-content">
                <form class="settings-form" id="passwordForm">
                    <div class="form-group">
                        <label class="form-label">Souƒçasn√© heslo</label>
                        <input type="password" class="form-control" name="current_password" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Nov√© heslo</label>
                        <input type="password" class="form-control" name="new_password" required minlength="6">
                        <div class="form-help">Minim√°lnƒõ 6 znak≈Ø</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Potvrdit nov√© heslo</label>
                        <input type="password" class="form-control" name="confirm_password" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Zmƒõnit heslo</button>
                </form>
            </div>
        </div>

        <!-- Study Preferences -->
        <div class="settings-card">
            <div class="card-header">
                <h3>üìö P≈ôedvolby studia</h3>
            </div>
            <div class="card-content">
                <form class="settings-form" id="studyPrefsForm">
                    <div class="form-group">
                        <label class="form-label">V√Ωchoz√≠ poƒçet ot√°zek</label>
                        <select class="form-control" name="default_questions">
                            <option value="5" selected>5 ot√°zek</option>
                            <option value="10">10 ot√°zek</option>
                            <option value="15">15 ot√°zek</option>
                            <option value="20">20 ot√°zek</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">V√Ωchoz√≠ poƒçet kartiƒçek</label>
                        <select class="form-control" name="default_flashcards">
                            <option value="5" selected>5 kartiƒçek</option>
                            <option value="10">10 kartiƒçek</option>
                            <option value="15">15 kartiƒçek</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="auto_save_notes" checked>
                            <span class="checkmark"></span>
                            Automaticky ukl√°dat pozn√°mky
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="email_reminders">
                            <span class="checkmark"></span>
                            Emailov√© p≈ôipom√≠nky studia
                        </label>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Ulo≈æit p≈ôedvolby</button>
                </form>
            </div>
        </div>

        <!-- Theme Settings -->
        <div class="settings-card">
            <div class="card-header">
                <h3>üé® Vzhled</h3>
            </div>
            <div class="card-content">
                <form class="settings-form" id="themeForm">
                    <div class="form-group">
                        <label class="form-label">Barevn√Ω motiv</label>
                        <div class="theme-options">
                            <label class="theme-option active">
                                <input type="radio" name="theme" value="light" checked>
                                <span class="theme-preview light-theme">
                                    <div class="theme-preview-header"></div>
                                    <div class="theme-preview-content"></div>
                                </span>
                                Svƒõtl√Ω
                            </label>
                            
                            <label class="theme-option">
                                <input type="radio" name="theme" value="dark">
                                <span class="theme-preview dark-theme">
                                    <div class="theme-preview-header"></div>
                                    <div class="theme-preview-content"></div>
                                </span>
                                Tmav√Ω
                            </label>
                            
                            <label class="theme-option">
                                <input type="radio" name="theme" value="auto">
                                <span class="theme-preview auto-theme">
                                    <div class="theme-preview-header"></div>
                                    <div class="theme-preview-content"></div>
                                </span>
                                Automaticky
                            </label>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Pou≈æ√≠t motiv</button>
                </form>
            </div>
        </div>

        <!-- Data & Privacy -->
        <div class="settings-card">
            <div class="card-header">
                <h3>üõ°Ô∏è Data a soukrom√≠</h3>
            </div>
            <div class="card-content">
                <div class="settings-section">
                    <h4>Export dat</h4>
                    <p>St√°hnƒõte si v≈°echna sv√° data ve form√°tu JSON.</p>
                    <button class="btn btn-secondary" id="exportDataBtn">üì• Exportovat data</button>
                </div>
                
                <div class="settings-section">
                    <h4>Vymaz√°n√≠ dat</h4>
                    <p class="warning-text">Tato akce je nevratn√°. V≈°echna va≈°e data budou trvale smaz√°na.</p>
                    <button class="btn btn-danger" id="deleteAccountBtn">üóëÔ∏è Smazat √∫ƒçet</button>
                </div>
            </div>
        </div>

        <!-- API Settings -->
        <div class="settings-card">
            <div class="card-header">
                <h3>üîß API nastaven√≠</h3>
            </div>
            <div class="card-content">
                <form class="settings-form" id="apiForm">
                    <div class="form-group">
                        <label class="form-label">OpenAI API kl√≠ƒç</label>
                        <div class="input-group">
                            <input type="password" class="form-control" name="openai_api_key" 
                                   placeholder="sk-..." value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            <button type="button" class="btn btn-secondary" id="toggleApiKey">üëÅÔ∏è</button>
                        </div>
                        <div class="form-help">Pro zmƒõnu API kl√≠ƒçe kontaktujte spr√°vce</div>
                    </div>
                    
                    <div class="api-status">
                        <div class="status-indicator online"></div>
                        <span>API p≈ôipojen√≠ je aktivn√≠</span>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .settings-container {
        max-width: 1000px;
        margin: 0 auto;
    }

    .settings-grid {
        display: grid;
        gap: 24px;
    }

    .settings-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        border: 1px solid var(--border-color);
        overflow: hidden;
    }

    .card-header {
        padding: 20px 24px;
        border-bottom: 1px solid var(--border-color);
        background: var(--light-color);
    }

    .card-header h3 {
        margin: 0;
        color: var(--dark-color);
        font-size: 1.2em;
    }

    .card-content {
        padding: 24px;
    }

    .settings-form {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
    }

    .form-label {
        font-weight: 500;
        color: var(--dark-color);
        margin-bottom: 8px;
    }

    .form-control {
        padding: 12px 16px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s ease;
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
    }

    .form-control:readonly {
        background: var(--light-color);
        color: var(--text-muted);
    }

    .form-help {
        font-size: 0.9em;
        color: var(--text-muted);
        margin-top: 4px;
    }

    .checkbox-label {
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
        font-weight: 500;
        color: var(--dark-color);
        margin-bottom: 0;
    }

    .checkbox-label input[type="checkbox"] {
        margin: 0;
        width: 20px;
        height: 20px;
    }

    .theme-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 16px;
        margin-top: 12px;
    }

    .theme-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        padding: 16px;
        border: 2px solid var(--border-color);
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
    }

    .theme-option:hover {
        border-color: var(--primary-color);
    }

    .theme-option.active {
        border-color: var(--primary-color);
        background: rgba(79, 172, 254, 0.05);
    }

    .theme-option input[type="radio"] {
        display: none;
    }

    .theme-preview {
        width: 60px;
        height: 40px;
        border-radius: 6px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        position: relative;
    }

    .theme-preview-header {
        height: 12px;
        background: var(--primary-color);
    }

    .theme-preview-content {
        height: 28px;
    }

    .light-theme .theme-preview-content {
        background: white;
    }

    .dark-theme .theme-preview-content {
        background: #2d3748;
    }

    .auto-theme .theme-preview-content {
        background: linear-gradient(90deg, white 50%, #2d3748 50%);
    }

    .settings-section {
        padding: 20px 0;
        border-bottom: 1px solid var(--border-color);
    }

    .settings-section:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }

    .settings-section h4 {
        margin: 0 0 8px 0;
        color: var(--dark-color);
        font-size: 1.1em;
    }

    .settings-section p {
        margin: 0 0 16px 0;
        color: var(--text-muted);
        line-height: 1.5;
    }

    .warning-text {
        color: var(--error-color) !important;
        font-weight: 500;
    }

    .btn-danger {
        background: var(--error-color);
        color: white;
        border: 1px solid var(--error-color);
    }

    .btn-danger:hover {
        background: #c82333;
        border-color: #bd2130;
    }

    .input-group {
        display: flex;
        gap: 0;
    }

    .input-group .form-control {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
        border-right: none;
    }

    .input-group .btn {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
        padding: 12px 16px;
    }

    .api-status {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 12px;
        font-size: 0.9em;
    }

    .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--text-muted);
    }

    .status-indicator.online {
        background: var(--success-color);
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }

    @media (max-width: 768px) {
        .settings-container {
            margin: 0 -10px;
        }
        
        .settings-card {
            border-radius: 8px;
        }
        
        .theme-options {
            grid-template-columns: 1fr;
        }
        
        .input-group {
            flex-direction: column;
        }
        
        .input-group .form-control {
            border-radius: 8px;
            border-right: 2px solid var(--border-color);
        }
        
        .input-group .btn {
            border-radius: 8px;
            margin-top: 8px;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    // Theme switching
    document.getElementById('themeForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const theme = formData.get('theme');
        
        // Apply theme (this would normally save to user preferences)
        if (theme === 'dark') {
            document.body.classList.add('dark-theme');
        } else {
            document.body.classList.remove('dark-theme');
        }
        
        // Show success message
        showNotification('Motiv byl zmƒõnƒõn!', 'success');
    });
    
    // Theme option selection
    document.querySelectorAll('.theme-option input[type="radio"]').forEach(radio => {
        radio.addEventListener('change', function() {
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
            });
            this.closest('.theme-option').classList.add('active');
        });
    });
    
    // Password form
    document.getElementById('passwordForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        
        if (formData.get('new_password') !== formData.get('confirm_password')) {
            showNotification('Hesla se neshoduj√≠!', 'error');
            return;
        }
        
        // Simulate password change
        showNotification('Heslo bylo √∫spƒõ≈°nƒõ zmƒõnƒõno!', 'success');
        this.reset();
    });
    
    // Study preferences form
    document.getElementById('studyPrefsForm').addEventListener('submit', function(e) {
        e.preventDefault();
        showNotification('P≈ôedvolby byly ulo≈æeny!', 'success');
    });
    
    // API key toggle
    document.getElementById('toggleApiKey').addEventListener('click', function() {
        const input = document.querySelector('input[name="openai_api_key"]');
        if (input.type === 'password') {
            input.type = 'text';
            this.textContent = 'üôà';
        } else {
            input.type = 'password';
            this.textContent = 'üëÅÔ∏è';
        }
    });
    
    // Export data
    document.getElementById('exportDataBtn').addEventListener('click', function() {
        showNotification('Exportov√°n√≠ dat bylo zah√°jeno...', 'info');
        
        // Simulate export
        setTimeout(() => {
            const data = {
                user: {
                    username: '{{ current_user.username }}',
                    email: '{{ current_user.email }}',
                    created_at: '{{ current_user.created_at.isoformat() }}'
                },
                export_date: new Date().toISOString(),
                notes: [],
                study_sessions: [],
                progress: []
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'studymate-data-export.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Data byla √∫spƒõ≈°nƒõ exportov√°na!', 'success');
        }, 2000);
    });
    
    // Delete account
    document.getElementById('deleteAccountBtn').addEventListener('click', function() {
        if (confirm('Opravdu chcete trvale smazat sv≈Øj √∫ƒçet? Tato akce je nevratn√°!')) {
            if (confirm('Jste si naprosto jisti? V≈°echna va≈°e data budou ztracena!')) {
                showNotification('Funkce maz√°n√≠ √∫ƒçtu je zat√≠m nedostupn√°.', 'info');
            }
        }
    });
    
    // Show notification function
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `flash-message ${type}`;
        notification.textContent = message;
        notification.style.cursor = 'pointer';
        notification.onclick = function() { this.remove(); };
        
        const container = document.querySelector('.flash-messages');
        container.appendChild(notification);
        
        // Auto-hide after 5 seconds
        setTimeout(() => {
            if (notification.parentElement) {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 300);
            }
        }, 5000);
    }
</script>
{% endblock %}